# Waddington Configure Implementation Download your copy with ```git clone git@github.com:FluidInc/imp-base.git``` ## Table of Contents - [Quick Start](#markdown-header-quick-start) - [Help](#markdown-header-help) - [Requirements](#markdown-header-requirements) - [Project Setup](#markdown-header-project-setup) - [Node Version](#markdown-header-node-version) - [Building Code](#markdown-header-building-code) - [Webpack HMR](#markdown-header-webpack-hmr) - [Scripts](#markdown-header-scripts) - [Development Scripts](#markdown-header-development-scripts) - [Utils Scripts](#markdown-header-utils-scripts) - [Test Scripts](#markdown-header-test-scripts) - [Build Scripts](#markdown-header-build-scripts) - [Publish Scripts](#markdown-header-publish-scripts) - [Testing and Debugging](#markdown-header-testing-and-debugging) - [Fluid Environment](#markdown-header-fluid-environment) - [Customizations](#markdown-header-customizations) - [Adding Styles](#markdown-header-adding-styles) - [Deploying Code](#markdown-header-deploying-code) - [QA/Prod CDN](markdown-header-qaprod-cdn) ## Quick Start `npm install && npm start` ## Help To see the help for the build tool, run: `imp --help` or just `imp` ## Requirements * [Node JS](http://nodejs.org/) This library is here to help setup and maintain Configure/Catalog implementations. We have a few different tools bundled in that we'll go over. **[⬆ back to top](#markdown-header-table-of-contents)** ## Project Setup The very first thing you'll want to do after downloading this project is removing all the references to "Base". We made this really easy by placing all customer related values in the ```package.json``` file. Those values are then built into the JavaScript file during a build. Once you've updated these values you'll need to install the dependencies. In your command line or terminal run the following command: ```$ npm install``` This will look in the ```package.json``` file and will download all the dependencies listed in ```devDependencies```. Once these are downloaded you can then begin building out the code. **[⬆ back to top](#markdown-header-table-of-contents)** ## Node Version The Node Version used is reflected at the file `.node-version` This version should be updated to LTS version so it reflects current [Node.js LTS version](https://nodejs.org/en/) If we install [Automatic Version switching for Node](https://github.com/wbyoung/avn) that supports several [node version managers](https://github.com/wbyoung/avn#plugins) we can benefit from using automatically the right version. **[⬆ back to top](#markdown-header-table-of-contents)** ## Building Code We are using as build tool our [@fluid.inc/imp-tools-build](https://www.npmjs.com/package/@fluid.inc/imp-tools-build) which will make available the `imp` command. > REMEMBER: > You should have `./node_modules/.bin` included in your path > If you don't, please add it with `export PATH=./node_modules/.bin:$PATH` If you don't want to add `./node_modules/.bin` to your path, you can always call it directly at `./node_modules/.bin/imp` You just need to run `imp` or `imp --help` to see the different options available with some examples. **[⬆ back to top](#markdown-header-table-of-contents)** #### Webpack HMR If you run the command `imp start` or `npm start` the [Webpack HMR](https://webpack.js.org/concepts/hot-module-replacement/) will start and will make available [http://localhost:8080](http://localhost:8080) That will show you the index page for the project you are working on. **[⬆ back to top](#markdown-header-table-of-contents)** ### Scripts To run any of the following scripts you have to use `imp [script_that_you_want_to_run]` ex: ```bash imp publish dev ``` #### Development Scripts + `npm start` or `imp start` * Will launch `hmr` #### Build Scripts ##### DEV + `imp dev test` * Builds `dev` files to `dist` folder. + `imp dev` * Builds `dev` files to `dist` folder. ##### QA + `imp qa` * Builds `qa` files to `dist` folder. + `imp qa cdn` * Builds `qa` with `cdn` option files to `dist` folder. + `imp qa cdn watch` * Builds `qa` with `cdn` option files to `dist` folder in watch mode, so when we modify a file, it will update the build. * This option does include `Live Reload`. ##### PROD + `imp prod` * Builds `prod` files to `dist` folder. + `imp prod cdn` * Builds `prod` with `cdn` option files to `dist` folder. + `imp prod cdn watch` * Builds `prod` with `cdn` option files to `dist` folder in watch mode, so when we modify a file, it will update the build. * This option does include `Live Reload`. #### Publish Scripts ##### DEV + `imp publish dev` * Publish to `dev`. + `imp publish dev test` * Publish to a `test` location the `dev` dist files.. ##### QA + `imp publish qa` * Publish to `qa`. + `imp publish qa cdn` * Publish to `qa` `cdn` location. ##### PROD + `imp publish prod` * Publish to `prod` + `imp publish prod cdn` * Publish to `prod` `cdn` location. ## Testing and Debugging ### Fluid Environment Sometimes in implementation code we need a way to only trigger logic in Fluid environments. A flag 'fluidEnv' has been added to the Fluid configureParams object. This flag can be used locally and in Fluid environments for executing logic that should not run in a clients environment. ``` if (mergedParams.fluidEnv) { // do fluid only stuff... } ``` ### Unit Tests. The unit tests have to be included at `__tests__/unit` folder. Can be run using: ``` npm test ``` ### Integration Tests In order to automate user interface tests, integration tests have been added to the `__tests__/integration` directory. These tests are run inside a headless Chromium instance using [Puppeteer](https://github.com/GoogleChrome/puppeteer) and the test runner, [Jest](https://facebook.github.io/jest/). Tests can be run by executing ``` npm run test:integration ``` **[⬆ back to top](#markdown-header-table-of-contents)** ## Customizations If you need to add functionality to the ```global.js```, and you likely always will, the best way to do that is by adding methods to the global ```app``` object (ex: checkUrlParam). If you want a "private" method then you can add those as well `(ex: _getObjectByKey).` **[⬆ back to top](#markdown-header-table-of-contents)** ## Adding Styles All of our styles are saved in ```app/scss/``` we have tried to break out the style by functional area. We are using the SASS CSS framework to build these and have some base mixins and variables defined. We have tried to give some basic structure to each file to make it easier to incorporate your own styles. **[⬆ back to top](#markdown-header-table-of-contents)** ## Deploying Code Now that you've written your JavaScript, tweaked the SASS and you're ready to push your changes up you need to follow a few quick steps: 1. Commit any local changes and push them to the repo 2. Make sure your master branch has the lastest changes from the repo 3. Run the publish task ```$ imp publish dev```. The above publish task will run a full build and then will upload those files to our fluid-implementations bucket. This folder is found in the ```package.json``` file under ```customer.s3dir```. You will get two notifications via Growler. The first is to let you the the build was successful. The second is to tell you the files are finished uploading to S3. **[⬆ back to top](#markdown-header-table-of-contents)** ### QA/Prod CDN If you need to publish to the CDN on either the QA or Prod workflows you'll need to run the following command: ```$ imp publish cdn``` This will run a full build but rather than uploading to the fluid-implementations directory it will upload to the fluid-configure-etc directory. Once your upload is finished you'll need to deploy the files from inside the admin tools ```Publish > Publish Extra Files```. **[⬆ back to top](#markdown-header-table-of-contents)**
